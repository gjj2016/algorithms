# Java的内存划分、内存模型、volatile #
##  Java的内存划分 ##
Java程序运行时，JVM会将管理的内存划分为几个区域：

- 方法区：方法区是所有线程共享的，用于存放加载的类信息、静态变量、常量等。
- 堆：堆也是所有线程共享的，是对象划分的主要区域，也是垃圾回收的主要区域。
- 程序计数器：每个线程独立拥有一个程序计数器，用于指示程序的执行顺序
- 本地方法区：每个线程独立用于，主要为native方法服务
- 虚拟机栈：随着线程的创建而创建，因此是每个线程独立拥有的。虚拟机栈又叫方法执行的内存模型，每个方法对应虚拟机栈中的一个栈帧，而每个栈帧由局部变量、参数列表等信息构成。

## Java内存模型 ##
Java内存模型描述的是一组规范，这组规范规定了程序中各个变量的访问方式，更具体的说就是一个程序对应一个或者多个线程，这多个线程如何操作存储、访问各个变量。

Java内存模型规定每个线程只能操作自己的工作内存、而不能直接操作主存。线程在实际执行过程中，需要先将主存中的操作数拷贝到自己的工作内存中，在工作内存中完成操作之后再将操作数写回到主存中，当多个线程操作同一个操作数时，可能会产生线程安全问题。

**工作内存：**每个线程都有自己独立的工作内存，因此工作内存是线程独立的。理论上应该是存放程序计数器、虚拟机栈以及本地方法区的。线程操作工作内存中的数据不会产生线程安全问题。对于基本数据类型，线程的工作内存中直接将其值存放在栈帧中，如果是引用类型的变量，那么该变量的引用会存储在栈帧中，而对象会在主存中划分。

**主存：**主存是所有线程的共享空间，理论上存放的是堆和方法区。线程将操作数写回到主存时，可能由于多个线程操作了同一个操作数而产生线程安全问题。