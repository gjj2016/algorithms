# 数据库 #
## 数据完整性包括： ##

	实体完整性，参照完整性，用户定义完整性。
	
	实体完整性：关系数据库中所有的表都必须有主码；
	参照完整性：关系表中外码为引用某个其他关系的主码或候选码；
	用户定义完整性：指明关系中属性的取值范围，也就是属性的域。

## 数据库范式 ##
**第一范式（1NF）**是指数据库表的每一列都是不可分割的基本数据项

**第二范式（2NF）**是在第一范式（1NF）的基础上建立起来的，且每一个非主属性完全函数依赖于候选键，不能存在组合关键字中的字段决定非关键字的情况。

如选课关系表为SelectCourse(学号, 姓名, 年龄, 课程名称, 成绩, 学分)，关键字为组合关键字(学号, 课程名称)，存在如下决定关系：

 

(课程名称) → (学分)

 

(学号) → (姓名, 年龄)

存在组合关键字中的某个字段决定了非主属性，不满足2NF；不满足2NF时会存在以下几个问题：

- 数据冗余：姓名、年龄、学分会被重复存储。
- 更新异常：调整某门课程的学分，数据表中所有行的"学分"值都要更新，否则会出现同一门课程学分不同的情况
- 插入异常：要开设一门新的课程，暂时还没有人选修。这样，由于还没有"学号"关键字，课程名称和学分也无法记录入数据库
- 删除异常：一批学生已经完成课程的选修，这些选修记录就应该从数据库表中删除。但是，与此同时，课程名称和学分信息也被删除了。

**第三范式（3NF）**在第二范式的基础上，属性不依赖于其它非主属性。

如学生关系表为Student(学号, 姓名, 年龄, 所在学院, 学院地点, 学院电话)，关键字为单一关键字"学号"，存在如下决定关系：

 

(学号) → (所在学院) → (学院地点, 学院电话)

非关键属性被非关键属性锁决定，不满足3NF；不满足3NF也会存在数据冗余、更新异常、插入异常和删除异常等问题。

**BCNF：**符合3NF，并且，主属性不依赖于主属性。

如（仓库ID，仓库管理员ID，物品ID，物品数量），主属性应该为（仓库ID，仓库管理员ID，物品ID），但是存在如下关系：

（仓库ID）  ->  （仓库管理员ID）

存在主属性间的依赖关系，不满虚BC范式。

## 封锁协议 ##
运用X锁和S锁对数据对象加锁时，还需要约定一些规则 ，例如何时申请X锁或S锁、持锁时间、何时释放等。称这些规则为封锁协议

- **一级封锁协议**：事务T在修改数据R之前必须先对其加X锁，直到事务结束才释放。事务结束包括正常结束（COMMIT）和非正常结束（ROLLBACK）。可以防止丢失修改，并保证事务T是可恢复的。如果仅仅是读数据不对其进行修改，是不需要加锁的，它不能保证可重复读和不读“脏”数据。
- **二级封锁协议**：一级封锁协议加上事务T在读取数据R之前必须先对其加S锁，读完后方可释放S锁。除防止了丢失修改，还可以进一步防止读“脏”数据。但在二级封锁协议中，由于读完数据后即可释放S锁，所以它不能保证可重复读。
- **三级封锁协议**：级封锁协议加上事务T在读取数据R之前必须先对其加S锁，直到事务结束才释放。除防止了丢失修改和不读“脏”数据外，还进一步防止了不可重复读。

